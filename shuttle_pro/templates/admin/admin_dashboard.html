<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | ShuttlePro</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    font-family: "Poppins", sans-serif;
    background-color: #f8fafc;
    color: #1e293b;
  }
  nav {
    background-color: #0f172a;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
  }
  .logo { font-size: 1.5rem; font-weight: 600; }
  .logout { background: #ef4444; color: white; border: none; border-radius: 8px; padding: 0.5rem 1rem; cursor: pointer; }
  .nav-links { display: flex; gap: 1rem; align-items: center; }
  .nav-links a { color: white; text-decoration: none; font-weight: 500; }
  .nav-links a:hover { text-decoration: underline; }

  .container { padding: 2rem; }
  h2 { color: #0f172a; margin-top: 0; }

  .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-top: 1rem; }

  .card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); text-align: center; }
  .card h3 { margin: 0 0 0.5rem 0; font-size: 1rem; color: #0f172a; }
  .card p { margin: 0; font-size: 1.5rem; font-weight: 600; }

  canvas { background: white; border-radius: 12px; padding: 1rem; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
</style>
</head>
<body>
<nav>
  <div class="logo">ShuttlePro Admin</div>
  <div class="nav-links">
    <a href="{% url 'admin_dashboard' %}">Dashboard</a>
    <a href="{% url 'admin_bookings' %}">Bookings</a>
    <a href="{% url 'admin_logs' %}">Logs</a>
    <form method="POST" action="{% url 'logout' %}" style="display:inline;">
      {% csrf_token %}
      <button class="logout">Logout</button>
    </form>
  </div>
</nav>

<div class="container">
  <h2>Welcome, {{ request.user.username }} ðŸ‘‹</h2>

  <!-- Summary Cards -->
  <div class="grid">
    <div class="card">
      <h3>Total Users</h3>
      <p>{{ total_users }}</p>
    </div>
    <div class="card">
      <h3>Total Bookings</h3>
      <p>{{ total_bookings }}</p>
    </div>
    <div class="card">
      <h3>Total Seats</h3>
      <p>{{ total_seats }}</p>
    </div>
    <div class="card">
      <h3>Total Revenue</h3>
      <p>â‚¹{{ total_revenue }}</p>
    </div>
  </div>

  <!-- Charts -->
  <div class="grid" style="margin-top:2rem;">
    <div class="card">
      <h3>Top 3 Zones</h3>
      <canvas id="zoneChart"></canvas>
    </div>
    <div class="card">
      <h3>Booking Trend (Last 7 Days)</h3>
      <canvas id="trendChart"></canvas>
    </div>
  </div>
</div>


<!-- Add below the previous charts section in container -->
<h2 style="margin-top: 3rem;">Recent Bookings</h2>
<table style="width:100%; border-collapse: collapse; margin-top:1rem; box-shadow: 0 4px 8px rgba(0,0,0,0.1); background:white; border-radius:12px; overflow:hidden;">
  <thead style="background:#0f172a; color:white;">
    <tr>
      <th>Passenger</th>
      <th>Zone</th>
      <th>Pickup â†’ Drop</th>
      <th>Seats</th>
      <th>Status</th>
      <th>Payment</th>
      <th>Created At</th>
    </tr>
  </thead>
  <tbody>
    {% for b in recent_bookings %}
    <tr style="background:{% cycle 'white' '#f1f5f9' %};">
      <td>{{ b.passenger.username }}</td>
      <td>{{ b.zone }}</td>
      <td>{{ b.pickup_location }} â†’ {{ b.drop_location }}</td>
      <td>{{ b.seats }}</td>
      <td>{{ b.status }}</td>
      <td>{{ b.payment_method }}</td>
      <td>{{ b.created_at|date:"d M Y H:i" }}</td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="7" style="text-align:center;">No bookings found</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h2 style="margin-top:3rem;">Top Routes</h2>
<div class="grid" style="margin-top:1rem;">
  <div class="card" style="grid-column: span 2;">
    <canvas id="routeChart"></canvas>
  </div>
</div>




<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // --- Top Zones Bar Chart ---
  const zoneCtx = document.getElementById('zoneChart').getContext('2d');
  const zoneChart = new Chart(zoneCtx, {
      type: 'bar',
      data: {
          labels: [{% for z in zone_stats %}'{{ z.zone }}',{% endfor %}],
          datasets: [{
              label: 'Bookings',
              data: [{% for z in zone_stats %}{{ z.count }},{% endfor %}],
              backgroundColor: '#3b82f6'
          }]
      },
      options: { responsive:true, plugins:{legend:{display:false}} }
  });

  // --- 7-Day Booking Trend Line Chart ---
  const trendCtx = document.getElementById('trendChart').getContext('2d');
  const trendChart = new Chart(trendCtx, {
      type: 'line',
      data: {
          labels: [{% for d in trend_data %}'{{ d.date }}',{% endfor %}],
          datasets: [{
              label: 'Bookings',
              data: [{% for d in trend_data %}{{ d.count }},{% endfor %}],
              fill: true,
              backgroundColor: 'rgba(59,130,246,0.2)',
              borderColor: '#3b82f6',
              tension: 0.4
          }]
      },
      options: { responsive:true, plugins:{legend:{display:false}} }
  });




  // --- Top Routes Bar Chart ---
const routeCtx = document.getElementById('routeChart').getContext('2d');
const routeChart = new Chart(routeCtx, {
    type: 'bar',
    data: {
        labels: [{% for r in top_routes %}'{{ r.route }}',{% endfor %}],
        datasets: [{
            label: 'Bookings',
            data: [{% for r in top_routes %}{{ r.count }},{% endfor %}],
            backgroundColor: '#f59e0b'
        }]
    },
    options: { responsive:true, plugins:{legend:{display:false}} }
});
</script>
</body>
</html>
